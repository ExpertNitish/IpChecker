<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IP & Location Tracker</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- Favicon -->
<link id="favicon" rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2216%22>üü¢</text></svg>">

<style>
/* Background Gradient */
body {
  margin: 0;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0072ff, #00c6ff);
  color: #333;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 30px 15px;
  box-sizing: border-box;
}

/* Title / IP text */
h1 {
  color: #fff;
  font-size: 28px;
  text-align: center;
  margin-bottom: 25px;
  transition: all 0.3s ease;
}

/* Glowing heading animation */
.glow {
  animation: headingGlow 1s infinite alternate;
}

@keyframes headingGlow {
  from { text-shadow: 0 0 5px #ffcc00, 0 0 10px #ffcc00; }
  to   { text-shadow: 0 0 15px #ffcc00, 0 0 25px #ffcc00, 0 0 35px #ffcc00; }
}

/* Notification bar */
#ipChangeAlert {
  display: none;
  background: #ffcc00;
  color: #222;
  font-weight: bold;
  padding: 12px 20px;
  border-radius: 8px;
  margin-bottom: 25px;
  text-align: center;
  animation: glow 1s infinite alternate;
  box-shadow: 0 0 10px rgba(255, 204, 0, 0.8);
  width: 100%;
  max-width: 600px;
}

@keyframes glow {
  from { box-shadow: 0 0 10px rgba(255, 204, 0, 0.8); }
  to { box-shadow: 0 0 20px rgba(255, 204, 0, 1); }
}

/* Info Table */
.info-box {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  padding: 25px;
  width: 100%;
  max-width: 400px;
  margin-bottom: 30px;
}

.info-box table {
  width: 100%;
  border-collapse: collapse;
}

.info-box td {
  padding: 10px 6px;
  border-bottom: 1px solid #eee;
  font-size: 14px;
  color: #333;
}

.info-box td:first-child {
  font-weight: bold;
  color: #555;
}

.info-box tr:last-child td {
  border-bottom: none;
}

/* Map */
#map {
  height: 400px;
  width: 100%;
  max-width: 600px;
  border-radius: 10px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  margin-bottom: 30px;
}

/* Footer */
footer {
  color: #fff;
  margin-bottom: 15px;
  font-weight: 500;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
  text-align: center;
}
</style>
</head>
<body>

<h1 id="pageTitle">IP & Location Tracker</h1>

<!-- Notification bar -->
<div id="ipChangeAlert"></div>

<!-- Info Box -->
<div class="info-box">
  <table>
    <tr><td>IP Address</td><td id="ip">Loading...</td></tr>
    <tr><td>City</td><td id="city">Loading...</td></tr>
    <tr><td>Region/State</td><td id="region">Loading...</td></tr>
    <tr><td>Country</td><td id="country">Loading...</td></tr>
    <tr><td>ZIP / Postal Code</td><td id="zip">Loading...</td></tr>
    <tr><td>Latitude</td><td id="lat">Loading...</td></tr>
    <tr><td>Longitude</td><td id="lon">Loading...</td></tr>
    <tr><td>Time Zone</td><td id="timezone">Loading...</td></tr>
    <tr><td>Currency</td><td id="currency">Loading...</td></tr>
  </table>
</div>

<!-- Map -->
<div id="map"></div>

<footer>Built with üíú Survey Captures</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
let lastIP = null;
let map, marker;
let titleBlinkInterval = null;

const currencySymbols = {
  USD: '$', CAD: 'CA$', AED: 'ÿØ.ÿ•', SAR: 'ÿ±.ÿ≥', INR: '‚Çπ', GBP: '¬£', EUR: '‚Ç¨'
};

function renderData(data) {
  document.getElementById("ip").textContent = data.ip || "N/A";
  document.getElementById("city").textContent = data.city || "N/A";
  document.getElementById("region").textContent = data.region || "N/A";
  document.getElementById("country").textContent = data.country_name || "N/A";
  document.getElementById("zip").textContent = data.postal || "N/A";
  document.getElementById("lat").textContent = data.latitude || "N/A";
  document.getElementById("lon").textContent = data.longitude || "N/A";
  document.getElementById("timezone").textContent = data.timezone || "N/A";
  const symbol = currencySymbols[data.currency] || '';
  document.getElementById("currency").textContent = data.currency ? `${data.currency} ${symbol}` : "N/A";

  if (!map) {
    map = L.map('map').setView([data.latitude, data.longitude], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    marker = L.marker([data.latitude, data.longitude]).addTo(map)
      .bindPopup(`<b>${data.city || 'Unknown'}, ${data.region || ''}</b><br>${data.country_name || ''}`)
      .openPopup();
  } else {
    map.setView([data.latitude, data.longitude], 10);
    marker.setLatLng([data.latitude, data.longitude])
      .setPopupContent(`<b>${data.city || 'Unknown'}, ${data.region || ''}</b><br>${data.country_name || ''}`);
  }
}

// Function to change favicon to danger
function setFaviconDanger() {
  const favicon = document.getElementById('favicon');
  favicon.href = "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 16 16%22><text y=%2214%22 font-size=%2216%22>‚ö†Ô∏è</text></svg>";
}

// Function to blink tab title
function startTitleBlink(newTitle, originalTitle) {
  if (titleBlinkInterval) clearInterval(titleBlinkInterval);
  let visible = true;
  titleBlinkInterval = setInterval(() => {
    document.title = visible ? newTitle : originalTitle;
    visible = !visible;
  }, 1000);
}

function checkIP() {
  fetch('https://ipapi.co/json/')
    .then(res => res.json())
    .then(data => {
      if (lastIP && lastIP !== data.ip) {
        const alertBar = document.getElementById("ipChangeAlert");
        alertBar.style.display = "block";
        alertBar.innerHTML = `‚ö†Ô∏è Your IP has changed!<br>Old IP: <b>${lastIP}</b><br>New IP: <b>${data.ip}</b>`;
        
        // Make heading glow
        document.getElementById("pageTitle").classList.add("glow");

        // Change favicon to danger
        setFaviconDanger();

        // Start blinking tab title
        startTitleBlink("‚ö†Ô∏è Changed!", "IP & Location Tracker");
      }
      lastIP = data.ip;
      renderData(data);
    })
    .catch(err => console.error("Error fetching IP info:", err));
}

// Run once and then every 30 seconds
checkIP();
setInterval(checkIP, 30000);
</script>

</body>
</html>
